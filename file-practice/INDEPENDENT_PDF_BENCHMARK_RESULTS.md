# iText vs PDFBox 독립 벤치마크 결과 (프로덕션용)

## 📋 개요

완벽하게 독립적이고 통계적으로 유의미한 PDF 라이브러리 성능 비교입니다.

### 벤치마크 방법론

Excel 벤치마크와 동일한 엄격한 방법론 적용:
- ✅ 각 라이브러리를 **완전히 독립적인 테스트**로 분리 실행
- ✅ **JMX** 를 사용한 정밀한 메모리 측정
- ✅ 워밍업 **3회** + 측정 **5회** 반복
- ✅ 통계 분석 (평균, 중앙값, 표준편차, 변동계수)

### 주요 차이점

| 특성 | iText7 | Apache PDFBox |
|-----|--------|---------------|
| 라이선스 | AGPL (상업용은 유료) | Apache 2.0 (완전 무료) |
| 한글 지원 | ✅ 지원 | ❌ 미지원 (표준 폰트만) |
| API 복잡도 | 중간 | 저수준 (더 복잡) |
| 기능 | 풍부 (차트, 수식 등) | 기본 기능 |

---

## 📊 벤치마크 결과 (1,000건 데이터)

### 실행 시간

| 라이브러리 | 평균 | 중앙값 | 표준편차 | 최소 | 최대 | 변동계수 |
|-----------|------|--------|---------|------|------|----------|
| **iText7** | 1,087 ms | 935 ms | 383.88 ms | 845 ms | 1,850 ms | 35.29% |
| **PDFBox** | **285 ms** | **280 ms** | **16.27 ms** | 268 ms | 316 ms | **5.70%** |

**🏆 승자: PDFBox**
- **74% 빠름** (1,087ms → 285ms)
- **훨씬 안정적** (변동계수 35.29% → 5.70%)

---

### 힙 메모리 사용량

| 라이브러리 | 평균 | 중앙값 | 표준편차 | 최소 | 최대 | 변동계수 |
|-----------|------|--------|---------|------|------|----------|
| **iText7** | **38.33 MB** | **25.34 MB** | 29.71 MB | 19.32 MB | 97.31 MB | 77.51% |
| **PDFBox** | 125.22 MB | 124.43 MB | **1.16 MB** | 124.42 MB | 127.41 MB | **0.93%** |

**🏆 승자: iText7**
- **69% 적게 사용** (125.22MB → 38.33MB 평균)
- PDFBox가 훨씬 안정적 (변동계수 77.51% → 0.93%)

---

### 파일 크기

| 라이브러리 | 평균 | 중앙값 | 표준편차 | 변동계수 |
|-----------|------|--------|---------|----------|
| **iText7** | 1.12 MB | 1.12 MB | 2.44 KB | 0.21% |
| **PDFBox** | **380.74 KB** | 380.74 KB | 529 B | 0.14% |

**🏆 승자: PDFBox**
- **66% 작은 파일** (1.12MB → 380.74KB)
- 둘 다 매우 일관적인 파일 크기

---

## 🎯 종합 분석

### 1. 실행 시간 (Performance) 🚀

```
PDFBox가 압도적으로 빠름:
- 1,000건: PDFBox 285ms vs iText 1,087ms (74% 빠름)
- 안정성: PDFBox 변동계수 5.70% (매우 안정적)
```

**PDFBox의 빠른 이유**:
- 저수준 API로 직접 PDF 스트림에 쓰기
- 간단한 렌더링 엔진
- 오버헤드가 적은 구조

### 2. 메모리 효율 (Memory Efficiency) 💾

```
iText7이 메모리 효율적:
- 평균: iText 38.33MB vs PDFBox 125.22MB (69% 절감)
- 중앙값: iText 25.34MB vs PDFBox 124.43MB (80% 절감)
```

**iText7의 메모리 효율 이유**:
- 고수준 추상화로 내부 최적화
- 페이지 단위 flush 메커니즘
- 더 효율적인 객체 재사용

**주의**: iText7의 메모리 사용량 변동이 큼 (변동계수 77.51%)

### 3. 파일 크기 (Output Size) 📄

```
PDFBox가 압축 효율적:
- iText: 1.12 MB
- PDFBox: 380.74 KB (66% 작음)
```

**PDFBox의 작은 파일 크기 이유**:
- 불필요한 메타데이터 최소화
- 간단한 구조
- iText는 더 많은 기능을 위한 오버헤드 포함

### 4. 안정성 (Stability) ⚖️

**실행 시간 안정성**:
- PDFBox: **5.70% CV** ⭐ (매우 안정적)
- iText: 35.29% CV

**메모리 사용 안정성**:
- PDFBox: **0.93% CV** ⭐ (완벽히 일관적)
- iText: 77.51% CV

---

## 🏆 최종 권장사항

### ✅ Apache PDFBox 사용 권장

```kotlin
// 추천 사용 사례
when {
    실행_속도가_최우선 -> "PDFBox 사용" // 74% 빠름
    파일_크기가_중요함 -> "PDFBox 사용" // 66% 작음
    라이선스_비용_부담 -> "PDFBox 사용" // Apache 2.0 무료
    단순_PDF_생성 -> "PDFBox 사용"
    한글_미지원_괜찮음 -> "PDFBox 사용"
}
```

**장점**:
- ✅ **압도적인 실행 속도** (74% 빠름)
- ✅ **작은 파일 크기** (66% 작음)
- ✅ **완전 무료** (Apache 2.0 라이선스)
- ✅ **매우 안정적** (변동계수 5.70%)
- ✅ 예측 가능한 메모리 사용량

**단점**:
- ❌ 메모리를 더 많이 사용 (3.3배)
- ❌ 한글 미지원 (표준 폰트만)
- ❌ 저수준 API (개발 복잡도 높음)
- ❌ 제한적인 고급 기능

---

### ✅ iText7 사용 권장

```kotlin
// 추천 사용 사례
when {
    한글_지원_필수 -> "iText 사용" // 한글 폰트 지원
    복잡한_레이아웃 -> "iText 사용" // 테이블, 차트 등
    메모리가_제한적 -> "iText 사용" // 69% 적게 사용
    고급_기능_필요 -> "iText 사용" // 디지털 서명, 암호화
    고수준_API_선호 -> "iText 사용"
}
```

**장점**:
- ✅ **메모리 효율** (69% 적게 사용, 평균 기준)
- ✅ **한글 지원** (한국 서비스 필수)
- ✅ **풍부한 기능** (차트, 수식, 암호화 등)
- ✅ **고수준 API** (개발 편의성)

**단점**:
- ❌ 실행 시간 느림 (74% 느림)
- ❌ 큰 파일 크기 (3배 큼)
- ❌ **상업용 라이선스 비용** (AGPL)
- ❌ 메모리 사용량 변동 큼 (예측 어려움)

---

## 📊 데이터 크기별 권장 기준표

| 데이터 크기 | 권장 라이브러리 | 이유 | 예상 시간 | 예상 메모리 |
|-----------|----------------|-----|-----------|-----------|
| < 5,000건 | **PDFBox** | 빠른 생성 속도 | ~285ms | ~125 MB |
| 5,000 ~ 50,000건 | **상황에 따라** | 한글 필요시 iText | 1-10초 | 40-200 MB |
| > 50,000건 | **iText** | 메모리 효율 중요 | 10초+ | 메모리 효율적 |

**특수 상황**:
- **한글 PDF 필수**: iText (PDFBox는 한글 미지원)
- **실시간 생성**: PDFBox (74% 빠름)
- **저장 공간 제약**: PDFBox (66% 작은 파일)
- **메모리 제약 심함**: iText (69% 적은 메모리)
- **라이선스 비용 부담**: PDFBox (완전 무료)

---

## ⚠️ 중요 고려사항

### 1. 한글 지원

**iText7**:
```kotlin
// 한글 폰트 지원
val koreanFont = PdfFontFactory.createFont("HYSMyeongJo-Medium", "UniKS-UCS2-H")
paragraph.setFont(koreanFont)
paragraph.add("주문 내역서") // ✅ 정상 표시
```

**PDFBox**:
```kotlin
val font = PDType1Font.HELVETICA
stream.showText("주문 내역서") // ❌ 오류 발생!
stream.showText("Order History") // ✅ 영문만 가능
```

**결론**: **한국 서비스에서는 iText가 필수**

### 2. 라이선스 비용

| 라이브러리 | 라이선스 | 상업용 사용 | 비용 |
|-----------|---------|-----------|------|
| **PDFBox** | Apache 2.0 | ✅ 무료 | 0원 |
| **iText7** | AGPL | ❌ 유료 | 수백만원~ |

**iText 상업용 라이선스** 필요 조건:
- 독점 소프트웨어 (소스 공개 안함)
- SaaS 서비스
- 임베디드 제품

**결론**: 예산이 제한적이면 PDFBox

### 3. 성능 vs 기능 트레이드오프

```
PDFBox: 🚀🚀🚀 속도  vs  🔧 기능
iText:  🚀   속도  vs  🔧🔧🔧 기능
```

---

## 🔬 테스트 재현 방법

### 개별 테스트 실행

```bash
# iText 벤치마크
./gradlew cleanTest test --tests "com.example.filepractice.performance.IndependentPdfBenchmark.iText 독립 벤치마크 - 1000건"

# PDFBox 벤치마크
./gradlew cleanTest test --tests "com.example.filepractice.performance.IndependentPdfBenchmark.PDFBox 독립 벤치마크 - 1000건"
```

### 전체 벤치마크 실행

```bash
./gradlew cleanTest test --tests "com.example.filepractice.performance.IndependentPdfBenchmark"
```

---

## 🎓 최종 결론

**한국 서비스 (한글 필수)**: **iText7** 🏆
- 한글 지원이 필수적
- 메모리 효율적
- 속도는 느리지만 허용 가능

**글로벌 서비스 (영문만)**: **PDFBox** 🏆
- 압도적인 속도 (74% 빠름)
- 작은 파일 크기 (66% 작음)
- 완전 무료
- 매우 안정적

**최적 전략**: **하이브리드 접근**
```kotlin
fun generatePdf(orders: Sequence<Order>, needsKorean: Boolean, output: OutputStream) {
    if (needsKorean) {
        iTextService.generatePdf(orders, output) // 한글 지원
    } else {
        pdfBoxService.generatePdf(orders, output) // 빠른 성능
    }
}
```

**프로덕션 권장사항**:
1. **기본은 iText** (한글 지원, 안정성)
2. **영문 전용은 PDFBox** (속도, 비용 절감)
3. **대용량은 iText** (메모리 효율)
